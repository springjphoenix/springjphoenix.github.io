webpackJsonp([0xe55e60bfea4a],{731:function(a,n){a.exports={data:{site:{siteMetadata:{title:"Magicly's Blog",author:"Magicly"}},markdownRemark:{id:"/Users/spring/Developer/Gatsby/gatsby-blog/src/pages/wechat-sdk.md absPath of file >>> MarkdownRemark",html:'<p>最近做个app要接入一下微信sdk，按理说很简单的， 但是碰到很多坑， 记录一下。</p>\n<!-- more -->\n<p>APP是用RN做的， 自然想找一个封装好的RN微信，于是找到了<a href="https://github.com/yorkie/react-native-wechat">https://github.com/yorkie/react-native-wechat</a> ，这个还算是star多得， 有1000多个， 相比另外一个<a href="https://github.com/reactnativecn/react-native-wx">https://github.com/reactnativecn/react-native-wx</a> 貌似要活跃一些，用户也较多， 那就选react-native-wechat吧， 结果也已经7个多月没有更新过了，里面用的android的sdk都是两年多前的， 作者貌似都不知道现在用gradle了。自然也就不支持微信小程序分享。 后来看到有人提交了PR: <a href="https://github.com/yorkie/react-native-wechat/pull/324">https://github.com/yorkie/react-native-wechat/pull/324</a> ，更新了sdk，支持小程序， 不过作者貌似没有merge。 索性干脆直接依赖这个fork吧：<a href="https://github.com/LittoCats/react-native-wechat">https://github.com/LittoCats/react-native-wechat</a> .</p>\n<p>然后就是按照说明配置好依赖和appId等。 结果，死活分享不出去。后来能分享出去了， 但是卡死在调用哪里， 都已经用try/catch包起来了， 但是两条路都没有走。</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js">    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Wechat<span class="token punctuation">.</span><span class="token function">shareToTimeline</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        type<span class="token punctuation">:</span> <span class="token string">\'text\'</span><span class="token punctuation">,</span>\n        description<span class="token punctuation">:</span> <span class="token string">\'hello, wechat\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'share text message to time line successful:\'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span></code></pre>\n      </div>\n<p>既不成功，也不失败。。。。。</p>\n<p>然后去看JS源码，看Java源码。最后发现是Java里面的回调就没有执行：</p>\n<div class="gatsby-highlight">\n      <pre class="language-java"><code class="language-java">\t<span class="token comment">// 第三方应用发送到微信的请求处理后的响应结果，会回调到该方法</span>\n\t<span class="token annotation punctuation">@Override</span>\n\t<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResp</span><span class="token punctuation">(</span>BaseResp resp<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span></code></pre>\n      </div>\n<p>那应该就是包名或签名没有配置好了。 仔细检查没有问题啊， 也用微信提供的签名工具提取了签名。后来下载了微信的demo，一步一步调试和查资料尝试，过程花了两天， 懒得细说了，最后发现下面这些坑s：</p>\n<h2 id="微信平台审核过之后包名和签名可以修改么？"><a href="#%E5%BE%AE%E4%BF%A1%E5%B9%B3%E5%8F%B0%E5%AE%A1%E6%A0%B8%E8%BF%87%E4%B9%8B%E5%90%8E%E5%8C%85%E5%90%8D%E5%92%8C%E7%AD%BE%E5%90%8D%E5%8F%AF%E4%BB%A5%E4%BF%AE%E6%94%B9%E4%B9%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微信平台审核过之后包名和签名可以修改么？</h2>\n<p>可以。但是微信有缓存！！！要么卸载微信重装， 要么清楚微信数据， 记住是要从系统设置里面清除， 而不是从微信app里面清除！</p>\n<ul>\n<li><a href="http://ask.dcloud.net.cn/question/18354">http://ask.dcloud.net.cn/question/18354</a></li>\n<li><a href="http://blog.csdn.net/ZFY11/article/details/78216278">http://blog.csdn.net/ZFY11/article/details/78216278</a></li>\n</ul>\n<h2 id="微信后台配置的包名必须是manifest里面的package！！！"><a href="#%E5%BE%AE%E4%BF%A1%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE%E7%9A%84%E5%8C%85%E5%90%8D%E5%BF%85%E9%A1%BB%E6%98%AFmanifest%E9%87%8C%E9%9D%A2%E7%9A%84package%EF%BC%81%EF%BC%81%EF%BC%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微信后台配置的包名必须是manifest里面的package！！！</h2>\n<p>这个是最坑的。 因为RN默认生成的package和目录结构是<code class="language-text">com.xxx</code>，而我要取另外的包名，于是在<code class="language-text">app/build.gradle</code>文件里面改了<code class="language-text">applicationId</code>，以为可以了，结果不行！！！微信要的其实根本就不是APP的包名， 而是类的目录结构（也算是Java的包名吧。。。）！！！！\n至于manifest里的package和applicationId有什么区别，请看：</p>\n<ul>\n<li><a href="http://blog.csdn.net/qq1072313099/article/details/52872800">http://blog.csdn.net/qq1072313099/article/details/52872800</a></li>\n<li><a href="http://blog.csdn.net/u011889786/article/details/54296462">http://blog.csdn.net/u011889786/article/details/54296462</a></li>\n</ul>\n<p>跟同事分析， 微信sdk的工具机制应该是： 微信sdk里面注册了scheme，分享或登录后微信通过scheme通知微信sdk， 然后微信sdk根据“包名”找到我们的代码<code class="language-text">{package}.wxapi/WXEntryActivity.java</code>，然后执行里面的<code class="language-text">onResp()</code>回调函数。所以其实微信要的不是app的包名， 而是需要找到代码的位置！！！</p>\n<h2 id="微信分享sdk不支持分享多张图片"><a href="#%E5%BE%AE%E4%BF%A1%E5%88%86%E4%BA%ABsdk%E4%B8%8D%E6%94%AF%E6%8C%81%E5%88%86%E4%BA%AB%E5%A4%9A%E5%BC%A0%E5%9B%BE%E7%89%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微信分享sdk不支持分享多张图片</h2>\n<p>这个用系统的分享接口反而支持！\n<a href="https://github.com/yorkie/react-native-wechat/issues/270">https://github.com/yorkie/react-native-wechat/issues/270</a></p>',timeToRead:2,frontmatter:{title:"接入微信SDK的坑s",date:"2018-02-06",category:"FE",tags:["微信","Wechat","React Native","RN"],math:null}}},pathContext:{prev:{url:"/ts-react-starter/",title:"TypeScript React入门"},slug:"/wechat-sdk/",next:{url:"/canvas-webapp/",title:"照片合成webapp项目总结"}}}}});
//# sourceMappingURL=path---wechat-sdk-9d00fa63105085c33f30.js.map